# 支付宝理财性格测试小游戏交易策略

项目使用vue3 + vite构建，可在本地运行，输入每次的涨跌幅数据便可自动化给出策略中的决策建议

1. clone项目
```
git clone https://github.com/lizhink/alipay-game-trading
```
2. 在目录下安装环境依赖
```
npm install
```
3. 运行项目，打开本地代理地址使用
```
npm run dev
```

## 游戏规则
- 10000元初始资金
- 除了初始只能选择买入，后面有10步操作机会，每步可以选择买入、卖出、持有不动
- 后10次选择前会额外收到1000元
- 买入、卖出基础单位为总金额的1%

## 现实情况
- 若初始投入为1%，往后每一步都选择持有不动，最高确定收益有 `(10000 * 0.99) + 1000 * 10 = 19900`，加上第一步投资金额 `100` 元，总本金 `20000` 元
- 每步对投资市场涨跌可观察的变量为：行情跌幅

## 策略目标
```
总流程过后，盈利次数达到5次以上
```
## 策略思考

策略顺位：
```
1. 达成5次盈利
2. 保本金
3. 最大化收益
```

判断逻辑：
```
if (未达成5次盈利) {
    选择能最大概率能达成5次盈利的操作（决策逻辑一）
} else {
    在保本的前提下最大化预期收益的选择（决策逻辑二）
}
```

## 概率计算

### 盈利的概率

#### 初始投资可做出的决策
```
[买入1%, 买入2%，买入3% …… 买入100%]

合计 100 种决策
```
#### 余下10次里面每一次可做出的决策
```
[买入1%, 买入2%，买入3% …… 买入100%]

[卖出1%, 卖出2%，卖出3% …… 卖出100%]

[不作操作(买入0%)]

合计 201 种决策
```

#### 关键指标计算 - 决策逻辑一：盈利5次以上
计算做出决策后下一次行情跌幅要多少百分比(f)才能盈利:
```
本金差值a = 投资本金b - (可买金额c + 可卖金额d)

买入决策：
本金差值a < (可买金额c - 可买金额c * 买入比例e) + (可卖金额d + 可买金额c * 买入比例e) * 预期涨跌幅f - 投资本金b

卖出决策：
本金差值a < (可买金额c + 可卖金额d * 卖出比例e) + (可卖金额d - 可卖金额d * 卖出比例e) * 预期涨跌幅f - 投资本金b

不操作的决策：
本金差值a < 可买金额c + 可卖金额d * 预期涨跌幅f - 投资本金b
```

即

```
买入决策：
a < (c - c * e ) + (d + c * e) * f - b

卖出决策：
a < (c + d * e ) + (d - d * e) * f - b

不操作的决策：
a < c + d * f - b
```

换算求预期涨跌幅 f
```
买入决策：
f > (a - c + c * e + b) / (d + c * e)

卖出决策：
f > (a - c - d * e + b) / (d - d * e)

不操作的决策：
f > (a - c + b) / d
```

> 计算出来的 f 值越低，说明达到盈利的需要涨幅越小，越容易实现。所以在盈利次数没有达到5次前，优先选择 f 值低的决策选项。若 f 值为负数，则代表着保本的情况下还有跌的空间，若f值小于-0.35，则可以跳到决策逻辑二以获取保本的前提下最大化预期收益

#### 关键指标计算 - 决策逻辑二：在保本的前提下最大化预期收益（未成熟方案）

当达到5次盈利的目标后，开始往在保本的前提下选择最大化收益的决策了，此时需要一个关键变量：
```
预期最大跌幅：k
```
决策判断一：**即使经历最大预期跌幅，总金额价值也能大于本金**

*"目前知识储备量还不知道用什么概率统计公式得出预期值比较好，正在学习相关的统计概率学知识，等到知道用什么公式的时候更新把公式用上，根据过往的游戏经验（看上去可能与贝叶斯方法相关），暂时把预期最大跌幅取值为-0.35(-35%)"*

```
经历最大预期跌幅后的总金额 - 投资本金 > 0 

既

买入决策：
0 < (可买金额c - 可买金额c * 买入比例e) + (可卖金额d + 可买金额c * 买入比例e) * 预期最大跌幅k - 投资本金b

卖出决策：
0 < (可买金额c + 可卖金额d * 卖出比例e) + (可卖金额d - 可卖金额d * 卖出比例e) * 预期最大跌幅k - 投资本金b

不操作的决策：
0 < 可买金额c + 可卖金额d * 预期最大跌幅k - 投资本金b
```

决策判断二：**在满足判断一的前提下，寻找最大化潜在收益的决策**

> 投资的仓位越大，潜在收益越大。所以优先寻找在满足判断一的前提下投资仓位（可卖金额）最大的选项。

决策判断三：**发生跌幅超出35%，无发满足决策判断一（回本）前提的情况**

要考虑好保留手里仅有的筹码，计算亏损额，及亏损额占当前可卖金额的比例。

```
亏损占当前可卖金额比例x = 当前亏损y / 可卖金额d

历史平均涨跌幅h = (h1 + h2 + h3... + hn) / n
```

若这个比例低于历史平均涨跌幅，则把仓位留住不操作直到可以实现回本操作

若这个比例高于历史平均涨跌幅，清空可卖金额仓位止损，保护剩下的本金